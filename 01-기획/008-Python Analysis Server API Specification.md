# Python Analysis Server API Specification

## 1. Function Specification: Create Daily Report (Game-Specific)

- **Function Name**: `create_daily_report`
    
- **Description**: Triggers the analysis and generation of a daily report for a specified game and summoner. This endpoint leverages a Strategy Pattern to call the appropriate game-specific analyzer.
    
- **Key Business Logic**:
    
    - Receive `game_name` from the URL path and `summoner_name` from the request body.
        
    - Utilize `AnalysisFactory.get_analyzer(game_name)` to retrieve the correct game analyzer instance (e.g., `LolAnalyzer`, `ValorantAnalyzer`).
        
    - Call the `generate_report` method on the obtained analyzer instance, passing the `summoner_name`.
        
    - The analyzer will internally handle:
        
        - Riot API calls (for LoL).
            
        - Data processing (e.g., KDA, CS/min, DPM calculations for all 10 participants in a match).
            
        - Interaction with the database (Supabase) for storing raw match data and aggregated statistics.
            
        - Integration with Google AI API for generating insights.
            
    - Return the structured report data.
        
- **Validation Rules**:
    
    - `game_name` must be a supported game (e.g., 'lol', 'valorant').
        
    - `summoner_name` (from request body) must be provided.
        

### 2. API Endpoint

#### HTTP Method and Path

```
POST /api/v1/reports/{game_name}
```

#### Response Branching by Request Header

(The Python server primarily serves JSON responses to the Go server. Content negotiation for HTML is handled by the Go server.)

**Web Request (HTMX)**

N/A (Request comes from Go server, not directly from web browser.)

**Mobile Request (Flutter)**

```
Accept: application/json
Content-Type: application/json
```

#### Request Body (for POST/PUT)

**Web (Form Data)**

N/A (This API is called by the Go server using JSON.)

**Mobile (JSON)**

JSON

JSON

```
{
  "summoner_name": "PlayerName#TAG"
}
```

(This JSON body is sent by the Go server's `analysis.LolReportData` or similar client when communicating with the Python server.)

#### Response Specification

**Web Response (HTML)**

N/A (The Go server renders HTML based on this JSON response.)

**Mobile Response (JSON)**

JSON

JSON

```
{
  "champion_id": 103,
  "position": "MIDDLE",
  "tier_group": "HIGH_ELO",
  "total_games": 1250,
  "win_rate": 0.52,
  "avg_kda": 4.1,
  "avg_cs_per_min": 8.5,
  "avg_damage_per_min": 650.0,
  "ai_insights": {
      "performance_trend": "string",
      "recommendation": "string",
      "improvement_focus": "string",
      "confidence": "string"
  }
}
```

(This is a simplified example; actual response will contain detailed report data generated by the analyzer.)

### 3. Python FastAPI Handler Structure

Python

Python

```
# analysis_server/app/api/v1/reports.py
from fastapi import APIRouter, HTTPException
from app.services.analysis_factory import AnalysisFactory
from app.schemas.report import ReportRequest, DailyReportResponse # Assuming these Pydantic models exist

router = APIRouter()

@router.post("/{game_name}", response_model=DailyReportResponse)
async def create_daily_report(game_name: str, request: ReportRequest):
    try:
        analyzer = AnalysisFactory.get_analyzer(game_name)
        report = await analyzer.generate_report(summoner_name=request.summoner_name)
        return report
    except ValueError as e:
        raise HTTPException(status_code=404, detail=str(e))
    except Exception as e:
        # General error handling for internal issues during analysis
        raise HTTPException(status_code=500, detail=f"Failed to generate report: {e}")

```

### 4. Error Handling

- **Unsupported Game Name**:
    
    - **JSON Response**: Returns HTTP 404 Not Found with JSON:
        
        JSON
        
        ```
        {
          "detail": "'[game_name]'은(는) 지원하지 않는 게임입니다."
        }
        ```
        
- **Invalid Input (e.g., missing summoner_name in request body)**:
    
    - **JSON Response**: Returns HTTP 422 Unprocessable Entity (FastAPI's default for Pydantic validation errors) with detailed validation errors.
        
        JSON
        
        ```
        {
          "detail": [
            {
              "loc": ["body", "summoner_name"],
              "msg": "field required",
              "type": "value_error.missing"
            }
          ]
        }
        ```
        
- **Riot API Rate Limit Exceeded**:
    
    - **JSON Response**: Returns HTTP 429 Too Many Requests (if not handled gracefully by the internal Riot API client).
        
        JSON
        
        ```
        {
          "detail": "Riot API rate limit exceeded. Please try again later."
        }
        ```
        
- **Player Not Found (via Riot API)**:
    
    - **JSON Response**: Returns HTTP 404 Not Found (from analyzer's `generate_report`).
        
        JSON
        
        ```
        {
          "detail": "Player '[summoner_name]' not found in Riot API."
        }
        ```
        
- **Internal Server Error (e.g., database error, unexpected analysis failure, AI API error)**:
    
    - **JSON Response**: Returns HTTP 500 Internal Server Error with JSON:
        
        JSON
        
        ```
        {
          "detail": "Failed to generate report: [specific error message from internal logic]"
        }
        ```